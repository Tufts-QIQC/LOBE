\section{Compiling Ladder Operator Block-Encodings}
\label{sec:ladder-op-oracles}

In this work, we focus on generating block-encodings for second-quantized Hamiltonians that include both fermionic and bosonic ladder operators.
In this section, we provide a framework for compiling controlled block-encodings of products and linear combinations of fermionic and bosonic ladder operators.
The framework for generating these block-encodings primarily relies on infering the action of the operators on the fermionic and bosonic modes upon which the operator acts nontrivially. 
The compilations presented below are optimized primarily to reduce the number of non-Clifford operations and secondarily to reduce the number of block-encoding ancillae.

\subsection{Encoding}
\label{subsec:encoding}

The encoding that is used for the occupation of the fermionic modes is identical to the Jordan-Wigner encoding \cite{jordan-wigner}.
The map between a Fock state and a qubit state is given by: 
\begin{equation}
    \ket{n_{I_b}, \dots, n_{1_b}, n_{0_b}} \rightarrow \ket{q_{I_b}, \dots, q_{1_b}, q_{0_b}}
\end{equation}
where $n_{i_b} = q_{i_b} \in [0, 1]$ depending on if the $i^\text{th}$ fermionic mode is occupied ($\ket{1}$) or unoccupied ($\ket{0}$).
The number of qubits required for the fermionic system is equal to the number of fermionic modes.

The encoding scheme for bosons must be able to represent a number of bosons in the range $[0, \Omega]$ for each bosonic mode.
We choose to represent store the occupancy of a bosonic mode in binary notation following \cite{rhodes2024exponential}:
\begin{equation}
    \ket{n_{i_a}} \rightarrow \ket{b_j, b_{j-1}, ..., b_0}
\end{equation}
where the number of qubits needed to encode each mode is $\lceil \log_2{(\Omega + 1)} \rceil$ and the values of $b_j$ are given by the binary representation of $n_{i_a}$.
In this work, we assume that the maximum bosonic occupancy for each bosonic mode is identical.
However, this encoding scheme and the block-encoding constructions presented below can be easily adapted to allow for bosonic modes to have different maximum occupation numbers.

\subsection{Fermionic Ladder Operators}
\label{subsec:fermionic-be}

Here, we construct block-encodings for the fermionic creation ($b_j^\dagger$) and annihilation ($b_j$) operators.
As these are block-encodings of non-unitary operators, we define the associated unitary operators to be of the form of Eq. \ref{eq:general-block-encoding}:
\begin{equation}
    U_{b^\dagger_j} \ket{\psi} \ket{0}_\text{anc} = b^\dagger_j \ket{\psi}\ket{0}_\text{anc} + \beta_\psi \ket{\perp}
\end{equation}
The fermionic ladder operators have spectral norm of $1$ and therefore do not need to be rescaled.

The definition of the fermionic creation operator (Eq. \ref{eq:fermionic-creation}) results in two implications.
If the mode is \textit{unoccupied}, then the mode should become occupied and a sign should be applied based on the occupancy of the preceeding fermionic modes.
If the mode is occupied, then state should be zeroed-out. 
Therefore, the action of our unitary will be dependent on the occupation of the associated fermionic mode:
\begin{equation}
    U_{b^\dagger_j} \ket{\psi_j} \ket{0}_\text{anc} =
    \begin{cases} 
        \ket{1} \ket{0}_\text{anc} & \text{when $\ket{\psi_j}$ is $\ket{0}$} \\
        \ket{\perp} & \text{when $\ket{\psi_j}$ is $\ket{1}$} \\
    \end{cases}
\end{equation}
where the sign flip caused by the occupation of the preceeding fermionic modes is omitted for brevity.

\begin{figure}[h]
    \mbox{
        \include{figures/qpic-code/fermionic/creation}
        \include{figures/qpic-code/fermionic/annihilation}
    }
    \caption{
        \textbf{Fermionic Ladder Operator Block-Encodings}
        In subfigure (a), a block-encoding for the fermionic creation operator acting on the $j^\text{th}$ mode is given.
        In subfigure (b), a block-encoding for the fermionic annihilation operator acting on the $j^\text{th}$ mode is given.
        For a creation (annihilation) operator, the branch of the wavefunction will be flipped outside of the encoded subspace if the mode is occupied (unoccupied).
        The state is updated by applying Pauli $Z$ gates to the preceeding fermionic modes which result in the appropriate sign of the state and then by applying a Pauli $X$ gate to flip the occupation of the $j^\text{th}$ mode.
    }
    \label{fig:fermionic-be}
\end{figure}


A construction for $U_{b^\dagger_j}$ is given in subfigure \ref{fig:fermionic-be}a.
The initial Toffoli gate flips the ancilla qubit to indicate that the state has been zeroed-out when the control qubit is on ($\ket{1}$) and the fermionic mode is occupied ($\ket{1}$).
The sign of the output state can be applied appropriately using a series of controlled Pauli $Z$ operators applied to each of the fermionic modes with index $i < j$: $\vec{Z}_i$.
The occupation of the fermionic mode on which the ladder operator acts is updated using a controlled Pauli $X$ operator: $X_j$.

A block-encoding for the fermionic annihilation operator, $U_{b_j}$, can be constructed similarly to $U_{b^\dagger_j}$ and is shown in subfigue \ref{fig:fermionic-be}b.
The fermionic creation operator only acts nontrivially when the mode is \textit{unoccupied}.
Inversely, the fermionic annihilation operator will only act nontrivially if the mode is \textit{occupied}.
Therefore the block-encoding ancilla is flipped outside of the encoded subspace if the control qubit is on ($\ket{1}$) and the fermionic mode is unoccupied ($\ket{0}$).

As noted in Appendix \ref{sec:elbows}, each Toffoli gate can be implemented using 4 T gates and one clean ancilla.
These block-encodings have an optimal rescaling factor ($\lambda = 1$), require one block-encoding ancilla and one clean ancillae, and use four T gates.

\subsection{Products of Fermionic Ladder Operators}

As discussed in subsection \ref{subsec:be-products}, a block-encoding for a product of operators can be constructed using a product of the unitaries that block-encode each operator.
In this subsection, we construct block-encodings for a product of fermionic ladder operators that use fewer quantum resources than are required by this naive strategy.

\begin{figure}[h]
    \mbox{
        \include{figures/qpic-code/fermionic/products/number-operator}
        \include{figures/qpic-code/fermionic/products/2-number-ops-together}
    }
    \mbox{
        \include{figures/qpic-code/fermionic/products/2-body}
        \include{figures/qpic-code/fermionic/products/2-body-number-operator}
    }
    \caption{
        \textbf{Block-Encoding Products of Fermionic Ladder Operators}
        In subfigure (a), a block-encoding for the fermionic number operator acting on the $i^\text{th}$ mode ($b_i^\dagger b_i$) is given.
        In subfigure (b), a block-encoding for the product of two fermionic number operators acting on the $i^\text{th}$ and $j^\text{th}$ modes ($b_i^\dagger b_i b_j^\dagger b_j$) is given.
        In subfigure (c), a block-encoding for the operator $b_j^\dagger b_l$ with $i \neq l$ is given.
        In subfigure (d), a block-encoding for the operator $b_j^\dagger b_j b_l$ with $i \neq l$ is given.
    }
    \label{fig:fermionic-products-be}
\end{figure}

Consider the action of the fermionic number operator ($b_i^\dagger b_i$):
\begin{equation}
    \begin{split}
        b_i^\dagger b_i \ket{\psi_{b_i}} = \begin{cases} 
            \ket{1} & \text{when $\ket{\psi_{b_i}}$ is $\ket{1}$} \\
            0 & \text{when $\ket{\psi_{b_i}}$ is $\ket{0}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
If the $i^\text{th}$ mode is unoccupied, the state will be zeroed-out.
If the $i^\text{th}$ mode is occupied, then the state is left unchanged.

This action can be encoded using the circuit shown in subfigure \ref{fig:fermionic-products-be}a.
The Toffoli gate flips the block-encoding ancilla outside of the encoded subspace if the control is on and the $i^\text{th}$ mode is unoccupied.
Otherwise, the state of the system and the block-encoding ancilla are left unchanged.
Block-encoding this operator as the product of the block-encodings for $b_i$ and $b_i^\dagger$ would require two block-encoding ancillae and use $8$ T gates.
Meanwhile, this construction has an optimal rescaling factor ($\lambda = 1$), requires one block-encoding ancilla and one clean ancilla, and uses $4$ T gates.

A block-encoding circuit for the operator $b_j^\dagger b_l$ is given in subfigure \ref{fig:fermionic-products-be}c.
For this operator, we can infer that the state will be zeroed-out \textit{unless} both the $j^\text{th}$ mode is unoccupied and the $l^\text{th}$ mode is occupied.
If the control qubit is on and these two conditions are not both true, then the block-encoding ancilla is flipped outside of the encoded subspace.
The state of the system is updated based on the two operators in the order in which they would act upon the quantum state: $\vec{Z}X_l$ ($b_l$) then $\vec{Z}X_j$ ($b_j^\dagger$).
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires one block-encoding ancilla and two clean ancillae, and uses $8$ T gates.


This construction can be generalized to an arbitrary product of ladder operators.
Let $B$ represent the number of active modes in a term.
Where an ``active mode" is a mode that has a ladder operator applied to it within the current operator.
For example, the term $b_i b_j^\dagger b_k b_l^\dagger b_l$ has $4$ active modes.
Each active mode will contribute a new control condition on the state of the corresponding mode.
Therefore, a block-encoding circuit for a general product of fermionic ladder operators with $B$ active modes will have an optimal rescaling factor ($\lambda = 1$), require one block-encoding ancilla and $B$ clean ancillae, and use $4B$ T gates.

% \ws{
% A natural question to ask is how do these constructions compare with using an LCU block-encoding after applying the Jordan-Wigner transformation \cite{}?
% The Jordan-Wigner transformation maps each fermionic ladder operator (or number operator) to a sum of two Pauli operators.
% For an arbitrary product of fermionic ladder operators, expanding these linear combinations results in $2^{B}$ Paulis.
% The number of non-Clifford gates for LCU scales linearly with the number of operators and hence would scale exponentially with $B$ under this construction.
% Alternatively, one could construct LCU block-encodings for each of the ladder operators in a term by applying the Jordan-Wigner transformation to each ladder operator (or number operator) independently.
% The product of these block-encodings would then give a block-encoding of the term.
% For each ladder operator (or number operator), an LCU block-encoding would require one Toffoli gate and one ancilla qubit.
% A block-encoding of the whole term using this construction would then require $B$ Toffoli gates and $B$ block-encoding ancillae.
% }

\subsection{Linear Combinations of Fermionic Ladder Operators}


As discussed in subsection \ref{subsec:lco}, a block-encoding for a linear combination of operators can be constructed using the LCO framework.
In this subsection, we show how to construct block-encodings of linear combinations of products of fermionic ladder operators that use fewer quantum resources than are required by an LCO construction.
In particular, we give a generalized construction for a product of fermionic ladder operators plus its hermitian conjugate, however, we note that the strategies we present here are not restricted to hermitian conjugates.

\begin{figure}
    \mbox{
        \include{figures/qpic-code/fermionic/combinations/1-body-hc}
        \include{figures/qpic-code/fermionic/combinations/2-body-hc}
    }
    \include{figures/qpic-code/fermionic/combinations/3-body-hc}
    \caption{
        \textbf{Block-Encoding Product of Fermionic Operators Plus Hermitian Conjugate}
        In subfigure (a), a block-encoding for the operator $b_j + b_j^\dagger$ is given.
        In subfigure (b), a block-encoding for the operator $b_j b_l + b_l^\dagger b_j^\dagger$ is given.
        In subfigure (c), a block-encoding for the operator $b_j b_l b_n + b_n^\dagger b_l^\dagger b_j^\dagger$ is given.
    }
    \label{fig:fermionic-be-lc-small}
\end{figure}


Consider a linear combination of an individual fermionic ladder operator with its hermitian conjugate: $b_j^\dagger + b_j$.
The action of this operator on the two possible occupation states of the $j^\text{th}$ fermionic mode is given by:
\begin{equation}
    \label{eq:action-of-fermionic-op-plus-hc}
    \begin{split}
        (b_j^\dagger + b_j) \ket{\psi_{b_j}} = \begin{cases} 
            \ket{1} & \text{when $\ket{\psi_{b_j}}$ is $\ket{0}$} \\
            \ket{0} & \text{when $\ket{\psi_{b_j}}$ is $\ket{1}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
The sign flip depending on the parity of the occupation of the preceeding fermionic modes is omitted for brevity.

An LCO construction using the block-encodings for these two ladder operators presented in the previous section would have a rescaling factor of $\lambda = 2$, require two block-encoding ancillae and two clean ancillae, and use $12$ T gates.
However, by considering the action of this operator (Eq. \ref{eq:action-of-fermionic-op-plus-hc}) on the active mode, a more efficient block-encoding can be constructed.
A Pauli $X$ gate can be applied to the $j^\text{th}$ mode to flip the occupation and a string of Pauli $Z$ gates can be applied on each fermionic mode with index $i < j$ to apply the appropriate sign.
This results in the same decomposition one would arrive at using the Jordan-Wigner transformation ($\vec{Z}X_j$).
A circuit diagram for this block-encoding is shown in subfigure \ref{fig:fermionic-be-lc-small}a.
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires zero block-encoding ancillae and zero clean ancillae, and uses zero non-Clifford operations.

For a two-body fermionic operator and its hermitian conjugate ($b_j b_l + b_l^\dagger b_j^\dagger$) we arrive at a construction that differs from the Jordan-Wigner transformation.
We begin by swapping the operators in the second term using the anticommutation relations to ensure that the order in which the corresponding operators appear in each term is the same: $b_j b_l - b_j^\dagger b_l^\dagger$.
In the circuit, the order in which the system is updated based on the ladder operators is fixed so it must be consistent for both terms.
The action of the joined operator on the possible occupation states of the $i^\text{th}$ and $j^\text{th}$ fermionic modes is given by:
\begin{equation}
    \begin{split}
        (b_j b_l - b_j^\dagger b_l^\dagger) \ket{\psi_{b_j}, \psi_{b_l}} = \begin{cases} 
            \hspace{1em}\ket{11} & \text{when $\ket{\psi_{b_j}, \psi_{b_l}}$ is $\ket{00}$} \\
            -\ket{00} & \text{when $\ket{\psi_{b_j}, \psi_{b_l}}$ is $\ket{11}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
The additional sign flip caused by the parity of the preceeding modes will be consistent for both terms since the order at which the operators appear in each term is consistent.
The action of this operator on the system is determined by the parity of the two fermionic modes.
The state will be zeroed-out by the operator \textit{unless} $\ket{\psi_{b_j}} \oplus \ket{\psi_{b_l}} = \ket{0}$.

In subfigure \ref{fig:fermionic-be-lc-small}b, we give a circuit diagram for block-encoding this two-body operator.
The parity of the active modes can be computed using a CNOT gate controlled on the $j^\text{th}$ mode, targeting the $l^\text{th}$ mode.
If the control qubit is on and $\ket{\psi_{b_l}}$ is in the $\ket{1}$ state (odd parity), then the block-encoding ancilla is flipped to push that branch of the wavefunction outside of the encoded subspace.
After this operation, the parity can be uncomputed, returning the qubit storing the occupation of the $l^\text{th}$ mode to its original state.
Next, a $CZ$ gate that is $0$-controlled on the $j^\text{th}$ fermionic mode and $1$-controlled on the control qubit applies the desired sign flip onto the state corresponding to the term $- b_j^\dagger b_l^\dagger$.
Lastly, a series of $\vec{Z}X$ operators are applied to each active mode in the order at which the operators would be applied onto the system (right to left).

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/2-body-diff-daggers}
    \include{figures/qpic-code/fermionic/combinations/2-body-and-number-op}
    \caption{
        \textbf{Block-Encoding Product of Fermionic Operators Plus Hermitian Conjugate (modifications)}
        In subfigure (a), a block-encoding for the operator $b_j b_l^\dagger + b_l b_j^\dagger$ is given.
        In subfigure (b), a block-encoding for the operator $b_j b_l^\dagger b_n^\dagger b_n + b_n^\dagger b_n b_l b_j^\dagger$ is given.
    }
    \label{fig:fermionic-be-lc-modifications}
\end{figure}

For an operator of the form $b_j b_l^\dagger + b_l b_j^\dagger$, we can construct a similar block-encoding with a slight modification.
In this case, we simply flip the occupation of the $l^\text{th}$ mode using a Pauli $X$ gate before we compute the parity of the modes.
The circuit diagram for block-encoding this operator is given in subfigure \ref{fig:fermionic-be-lc-modifications}a.

Likewise, if a number operator is included in a term, this can be accounted for by including a $1$-control on that mode when determining if the block-encoding ancilla should be flipped and excluding that mode from any parity computations.
An example circuit diagram for an operator including a number operator is given in subfigure \ref{fig:fermionic-be-lc-modifications}b.

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/generalized}
    \caption{
        \textbf{Generalized Block-Encoding for Product of Fermionic Operators Plus Hermitian Conjugate}
        A block-encoding for the operator $b_i b_j ... b_m + b_m^\dagger ... b_j^\dagger b_i^\dagger$ is given.
        The $CZ$ gate highlighted in orange is present only if the swapping on the order of the operators in the second term induces a negative sign (an odd number of swaps are required).
        Block-encodings for similar operators such as those that include number operators or different arrangements of the creation and annihilation operators can be accounted for using the modifications shown in Figure \ref{fig:fermionic-be-lc-modifications}.
    }
    \label{fig:fermionic-be-lc}
\end{figure}

The construction of these block-encoding circuits can be generalized to any operator that is a product of fermionic operators plus its hermitian conjugate.
An example circuit diagram for this generalized construction is shown in Figure \ref{fig:fermionic-be-lc}.
If $C$ represents the number of active modes excluding modes where a number operator is acting on the mode, then the $CZ$ gate is present only if $(C \text{ choose } 2)$ is odd.
These block-encoding circuits will all have optimal rescaling factors ($\lambda=1$), require one block-encoding ancilla and $B - 1$ clean ancillae, and use $4(B-1)$ T gates.

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/non-conjugate}
    \caption{
        \textbf{Block-Encoding for Linear Combination of Non-Conjugate Fermionic Operators}
        A block-encoding for the operator $b_i b_j b_k^\dagger + b_j^\dagger b_i^\dagger b_k^\dagger$ is given.
    }
    \label{fig:fermionic-be-lc-not-conjugate}
\end{figure}

As mentioned, the strategy employed here to construct block-encodings of a linear combination of fermionic ladder operators is not restricted to hermitian conjugates.
Consider the action of the operator $b_i b_j b_k^\dagger + b_j^\dagger b_i^\dagger b_k^\dagger$ on the occupation states of the fermionic modes.
This operator will zero-out the state \textit{unless} both $\ket{\psi_{b_i}} \oplus \ket{\psi_{b_j}}$ and $\ket{\psi_{b_k}}$ are $\ket{0}$.
The implementation of the block-encoding for this operator is given in Figure \ref{fig:fermionic-be-lc-not-conjugate}.
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires one block-encoding ancilla and two clean ancillae, and uses $8$ T gates.

\subsection{Bosonic Ladder Operators}

In this section, we aim to define a family of unitaries that generate block-encodings of the bosonic creation ($a_i^\dagger$) and annihilation ($a_i$) operators.
From the defined action of the bosonic creation operator (Equation \ref{eq:bosonic-creation}), it is clear that we can define a block-encoding unitary of the form of Eq. \ref{eq:general-block-encoding}: 
\begin{equation}
    \label{eq:be-bos-creation}
    U_{a^\dagger_i} \ket{\omega_i} \ket{0}_\text{anc} = 
    \begin{cases}
        \sqrt{\omega_i + 1 / \Omega} \ket{\omega_i + 1} \ket{0}_\text{anc} + \beta_\psi \ket{\perp} & \text{when } \omega_i < \Omega \\
        \ket{\perp} & \text{when } \omega_i = \Omega \\
    
    \end{cases}
\end{equation}
where $\omega_i$ is the occupation number of the $i^\text{th}$ bosonic mode and the operator is rescaled by a factor of $\sqrt{\Omega}$.

\begin{figure}
    \mbox{
        \include{figures/qpic-code/bosonic/creation}
        \include{figures/qpic-code/bosonic/annihilation}
    }
    \caption{
        \textbf{Bosonic Ladder Operator Block-Encoding}
        In subfigure (a), a block-encoding for the bosonic creation operator ($a_i^\dagger$) is given.
        In subfigure (b), a block-encoding for the bosonic annihilation operator ($a_i$) is given.
    }
    \label{fig:bosonic-ladder-op-be}
\end{figure}

The desired action of the block-encoding circuit for the bosonic creation operator is to increase the occupation of the bosonic mode by $1$ and rotate the block-encoding ancilla such that it has a coefficient of $\sqrt{\omega_i + 1 / \Omega}$ in the $\ket{0}$ state when the initial occupation of the $i^\text{th}$ bosonic mode is $w_i$.
This can be achieved by applying an incrementer to the the bosonic mode which increases the occupation by $1 \mod \Omega$ in each branch of the wavefunction.
The desired amplitudes of the block-encoding ancilla can be obtained using a series of $R_y$ gates that are controlled on the corresponding bosonic occupation.
An example circuit diagram is given in subfigure \ref{fig:bosonic-ladder-op-be}a.
A block-encoding for the bosonic annihilation operator can be constructed similarly, but with the block-encoding ancilla rotated prior to the occupation of the mode being decremented (subfigure \ref{fig:bosonic-ladder-op-be}b).

The angles of the $R_y$ gates are determined classically by the following function:
\begin{equation}
    \label{eq:single-op-angles}
    \theta(\omega_i) = 
    \begin{cases} 
        2 \cos^{-1}\Big(\sqrt{\omega_i/\Omega}\Big) & \text{when } \omega_i < \Omega\\
        \pi & \text{when } \omega_i = \Omega
    \end{cases}
\end{equation}
where $\omega_i$ here in comparison with $\omega_i + 1$ in Eq. \ref{eq:be-bos-creation} is due to the occupation of the state being updated prior to the rotations.


An implementation of a controlled incrementer circuit is given in \cite{Gidney_2015} which requires $\lceil \log_2\Omega \rceil - 1$ clean ancillae and $3 \lceil \log_2\Omega \rceil$ T gates.
The series of uniformly controlled rotations can be decomposed via the protocol given in Möttönen et. al \cite{mottonen2004transformation}.
A discussion of different schemes to construct a \textit{controlled} set of uniformly controlled rotations is given in Appendix \ref{sec:multiplexed-rotations}.
The resource estimates quoted in the remainder of this work assume the decomposition that requires $\Omega + 3$ uncontrolled rotations and $4 \lceil{\log_2{\Omega}}\rceil$ T gates (Figure \ref{fig:gate-optimized-controlled-multiplexed-rotations}).
In total, this block-encoding has a rescaling factor of $\sqrt{\Omega}$, requires one block-encoding ancilla and $\lceil{\log_2{\Omega}}\rceil$ clean ancillae, and uses $7 \lceil \log_2\Omega \rceil$ T gates and (at most) $\Omega + 3$ arbitrary rotations.


\subsection{Products of Bosonic Ladder Operators}

In this subsection, we discuss constructing block-encodings for a product of bosonic ladder operators acting on the same mode.
Unlike fermions, multiple bosons can occupy the same bosonic mode and a series of bosonic ladder operators can be applied to the state without necessarily zeroing-out the state.
Products of bosonic ladder operators acting on different modes can be block-encoded using Theorem \ref{th:product}.

Consider the desired action of a block-encoding for series of $R$ bosonic creation operators acting on the $i^\text{th}$ bosonic mode:
\begin{equation}
    \label{eq:be-S-creation-ops}
    U_{(a^\dagger_i)^R} \ket{\omega_i} \ket{0}_\text{anc} = 
    \begin{cases}
        \prod_{r=1}^{R} \sqrt{(\omega_i + r) / \Omega} \ket{\omega_i + R} \ket{0}_\text{anc} + \beta_\psi \ket{\perp} & \text{when } \omega_i \leq \Omega - R \\
        \ket{\perp} & \text{when } \omega_i > \Omega - R \\
    \end{cases}
\end{equation}

\begin{figure}
    \mbox{
        \include{figures/qpic-code/bosonic/products/R-creation}
        \include{figures/qpic-code/bosonic/products/S-annihilation}
    }
    \include{figures/qpic-code/bosonic/products/R-creation-S-annihilation}
    \caption{
        \textbf{Block-Encoding Product of Bosonic Ladder Operators}
        In subfigure (a), a block-encoding for the operator $(a_i^\dagger)^R$ is given.
        In subfigure (b), a block-encoding for the operator $(a_i)^S$ is given.
        In subfigure (c), a block-encoding for the operator $(a_i^\dagger)^R (a_i)^S$ is given.
    }
    \label{fig:products-bosonic-operators}
\end{figure}

A block-encoding for this operator can be achieved by updating the occupation of the bosonic mode by $+R$ and then performing a single series of rotations.
A circuit diagram for this construction is shown in subfigure \ref{fig:products-bosonic-operators}a.

The angles of the $R_y$ rotations are determined classically by the following function:
\begin{equation}
    \theta(\omega_i, R) = 
    \begin{cases} 
        2\cos^{-1}\Big(\prod_{r=0}^{R-1}\sqrt{(\omega_i - r) / \Omega}\Big) & \text{when } \omega_i \leq \Omega - R \\
        \pi & \text{when } \omega_i > \Omega - R
    \end{cases}
\end{equation}
where $\omega_i - r$ here in comparison with $\omega_i + r$ in Eq. \ref{eq:be-S-creation-ops} is due to the occupation of the state being updated prior to these rotations.

A block-encoding for a bosonic annihilation operator being applied $S$ times can be achieved using a similar construction shown in subfigue \ref{fig:products-bosonic-operators}b.
The occupation of the mode is first decreased by $S$ and then the controlled multiplexed rotations are applied to pick up the corresponding coefficient on the block-encoding ancilla.
The function to determine the rotation angles is given by:
\begin{equation}
    \theta(\omega_i, S) = 
    \begin{cases} 
        2\cos^{-1}\Big(\prod_{s=1}^{S}\sqrt{(\omega_i + s) / \Omega}\Big) & \text{when } \omega_i \geq S \\
        \pi & \text{when } \omega_i < S
    \end{cases}
\end{equation}

Likewise, a block-encoding for an operator of the form $(a_i^\dagger)^R (a_i)^S$ can be constructed using a similar form (subfigue \ref{fig:products-bosonic-operators}c).
The occupation of the mode is updated by a value of $+ R - S$ and then the controlled multiplexed rotations are applied to pick up the corresponding coefficient on the block-encoding ancilla.
The function to determine the rotation angles is given by:
\begin{equation}
    \theta(\omega_i, R, S) = 
    \begin{cases} 
        2\cos^{-1}\Big(\prod_{r=0}^{R-1}\sqrt{(\omega_i - r) / \Omega} \prod_{s=1}^{S}\sqrt{(\omega_i - R + s) / \Omega}\Big) & \text{when } S \leq \omega_i \leq \Omega - R \\
        \pi & \text{Otherwise} 
    \end{cases}
\end{equation}

Incrementing a quantum register by a classical value can be implemented in multiple ways with different compilations having different space-time tradeoffs.
The resource estimates presented in this work assume the compilation given in Figure \ref{fig:addition-gate-efficient}, which requires (at most) $3 \lceil \log_2 \Omega \rceil$ T gates.
In total, these block-encoding circuits have a rescaling factor of $\lambda = \Omega^{(R+S)/2}$, require one block-encoding ancilla and $\lceil{\log_2{\Omega}}\rceil$ clean ancillae, and use (at most) $7 \lceil \log_2 \Omega \rceil$ T gates and $\Omega + 3$ arbitrary rotations.


\subsection{Linear Combinations of Bosonic Ladder Operators}

In this subsection, we discuss constructing block-encodings for a linear combination of a product of bosonic ladder operators with its hermitian conjugate.


\begin{figure}
    \include{figures/qpic-code/bosonic/combinations/1-op}
    \include{figures/qpic-code/bosonic/combinations/multi-ops}
    \caption{
        \textbf{Block-Encoding Product of Bosonic Ladder Operators Plus Hermitian Conjugate}
        In subfigure (a), a block-encoding for the operator $(a_i^\dagger + a_i)$ is given.
        In subfigure (b), a block-encoding for the operator $\big((a_i^\dagger)^R (a_i)^S + (a_i^\dagger)^S (a_i)^R\big)$ is given.
    }
    \label{fig:lc-bosonic}
\end{figure}


Consider the block-encodings for the operators $a_i^\dagger$ and $a_i$.
An efficient block-encoding of the operator $a_i^\dagger + a_i$ can be constructed using the symmetry between the two individual block-encodings. 
To apply the creation operator, the occupancy is increased by $1$ and then the rotations are applied, whereas for the annihilation operator, the rotations are applied first and then the occupancy is decreased by $1$.
Since the desired rotation angles are independent of which operator is being applied (Eq. \ref{eq:single-op-angles}), we can apply these rotations once for both operators.
However, one additional block-encoding ancilla is required to index between the two operators.
An example circuit diagram for this construction is shown in subfigue \ref{fig:lc-bosonic}a.
A block-encoding for the generalized operator $\big((a_i^\dagger)^R (a_i)^S + (a_i^\dagger)^S (a_i)^R\big)$ can be constructed similarly and is shown in subfigure \ref{fig:lc-bosonic}b.

\begin{figure}
    \include{figures/qpic-code/bosonic/combinations/generalized-hc}
    \caption{
        \textbf{Generalized Block-Encoding Product of Bosonic Ladder Operators Plus Hermitian Conjugate}
        A block-encoding for the operator $((a_i^\dagger)^{R_i} + a_i^{S_i})((a_j^\dagger)^{R_j} + a_j^{S_j})...((a_m^\dagger)^{R_m} + a_m^{S_m}) + h.c.$ is given.
    }
    \label{fig:lc-bosonic-general}
\end{figure}

Likewise, this construction can be generalized to a linear combination of a product of bosonic operators acting on different modes plus its hermitian conjugate.
An example circuit diagram for this construction is shown in Figure \ref{fig:lc-bosonic-general}.
For an operator acting on $B$ bosonic modes, these block-encodings have a rescaling factor of $\lambda = 2 \Omega^{T/2}$ where $T$ is the sum of the exponents of the operators in a term: $T = \sum_{b=0}^{B-1}(R_b+S_b)$.
Additionally, they require $B+1$ block-encoding ancillae and $\lceil{\log_2{\Omega}}\rceil + 1$ clean ancillae, and use (at most) $12B \lceil \log_2 \Omega \rceil + - 4(B - 1)$ T gates and $B(\Omega + 3)$ arbitrary rotations.


\subsection{Terms with Fermionic and Bosonic Ladder Operators}

In the previous subsections, we discussed strategies for compiling block-encodings of different operators acting on either fermionic or bosonic modes.
In this subsection, we discuss block-encodings for operators that contain operators that act on both fermionic and bosonic operators.

\begin{figure}
    % \include{figures/qpic-code/terms/naive-construction}
    \include{figures/qpic-code/terms/non-naive-construction}
    \include{figures/qpic-code/terms/non-naive-yukawa}
    \include{figures/qpic-code/terms/4-point-yukawa}
    \caption{
        \textbf{Block-Encoding Terms}
        In subfigure (a), a block-encoding for the operator $b_i^\dagger a_j^\dagger + a_j b_i$ is given.
        In subfigure (b), a block-encoding for the operator $ b_i^\dagger b_j^\dagger a_k^\dagger + a_k b_j b_i$ is given.
        In subfigure (c), a block-encoding for the operator $b_i^\dagger b_j^\dagger a_k^\dagger a_l^\dagger + a_l a_k b_j b_i$ is given.
    }
    \label{fig:be-term-example}
\end{figure}


Consider the action of the operator: $b_i a_j + a_j^\dagger b_i^\dagger$ on the respective fermionic and bosonic modes.
When the fermionic mode is occupied, only the operator $b_i a_j$ will act nontrivially.
Meanwhile if the fermionic mode is unoccupied, only the operator $a_j^\dagger b_i^\dagger$ will act nontrivially.
Therefore, the occupation of the fermionic mode can be used to dictate which bosonic operator should be applied to the system.
After the appropriate bosonic operator is applied, the fermionic system is updated.
A circuit diagram for this block-encoding in given in subfigue \ref{fig:be-term-example}(a).
This block-encoding circuit will have a rescaling factor of $\lambda = \sqrt{\Omega}$, requires one block-encoding ancillae and $\lceil \log_2\Omega \rceil + 1$ clean ancillae, and uses $12 \lceil \Omega \rceil - 4$ T gates and (at most) $\Omega + 3$ arbitrary rotations.

This strategy can be employed for other combinations of bosonic and fermionic ladder operators.
In the full Yukawa model the operator $b_i^\dagger b_j^\dagger a_k^\dagger + a_k b_j b_i$ is used to model the process of a boson being annihilated to form a fermion and antifermion and a fermion and antifermion being annihilated to form a boson.
A block-encoding for this operator is shown in subfigue \ref{fig:be-term-example}(b).
When constructing the circuit, the occupation of either fermionic mode can be used to determine which bosonic operator is applied to the system.
This block-encoding circuit will have a rescaling factor of $\lambda = \sqrt{\Omega}$, requires two block-encoding ancillae and $\lceil \log_2\Omega \rceil + 1$ clean ancillae, and uses $12 \lceil \Omega \rceil$ T gates and (at most) $\Omega + 3$ arbitrary rotations.

A similar block-encoding can be constructed for the operator $b_i^\dagger b_j^\dagger a_k^\dagger a_l^\dagger + a_l a_k b_j b_i$, which appears in the full Yukawa model.
An example circuit diagram for this block-encoding is shown in subfigue \ref{fig:be-term-example}(c).
This block-encoding circuit will have a rescaling factor of $\lambda = \Omega$, requires three block-encoding ancillae and $\lceil \log_2\Omega \rceil + 1$ clean ancillae, and uses $24 \lceil \log_2\Omega \rceil - 8$ T gates and (at most) $2\Omega + 6$ arbitrary rotations.

