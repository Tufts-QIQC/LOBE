\section{Constructing Ladder Operator Block-Encodings}
\label{sec:ladder-op-oracles}

In this work, we focus on generating block-encodings for second-quantized Hamiltonians that include both fermionic and bosonic ladder operators.
In the previous sections, we discussed different methods to block-encode operators that are described as a product or linear combination of other operators.
In this section, we provide a framework for efficiently block-encoding individual ladder operators, products of ladder operators, and particular linear combinations of ladder operators.
We choose to explicitly include control qubits in our constructions since most use-cases of block-encodings require them to be controlled and controlling operations typically increases the cost of the operation.

\subsection{Encoding}
\label{subsec:encoding}

The encoding that is used for the occupation of the fermionic modes is identical to the Jordan-Wigner encoding \cite{jordan-wigner}.
The map between a Fock state to a qubit state is given as 
\begin{equation}
    \ket{n_{I_b}, \dots, n_{1_b}, n_{0_b}} \rightarrow \ket{q_{I_b}, \dots, q_{1_b}, q_{0_b}}
\end{equation}
where $n_{i_b} = q_{i_b} \in [0, 1]$ depending on if mode $i$ is occupied ($\ket{1}$) or unoccupied ($\ket{0}$).
The number of qubits required for the fermionic system is equal to the number of fermionic modes.

The encoding scheme for bosons must allow for occupancies in the range $[0, \Omega]$ due to the absence of the Pauli exclusion principle.
We choose to represent store the occupancy of a bosonic mode in binary notation: 
\begin{equation}
    \ket{n_{i_a}} \rightarrow \ket{b_j, b_{j-1}, ..., b_0}
\end{equation}
where $j$ runs from $0$ to $\lceil \log_2{\Omega} \rceil - 1$ and the values of $b_j$ are given by the binary representation of $n_{i_a}$.
This is identical to the encoding used in \cite{rhodes2024exponential}. \ws{check citation}

Storing the occupation of each bosonic mode requires $\lceil \log_2{\Omega} \rceil$ qubits if we assume that the maximum bosonic occupation is the same for each bosonic mode.
This choice of the maximum bosonic occupation being constant for all bosonic modes is not a restriction of the methods presented in this work, but is chosen for simplicity. 
With this choice, the number of qubits required for the bosonic subsystem is: $Q_{\psi_a} = I_a \lceil \log_2{\Omega} \rceil$.

\subsection{Fermionic Ladder Operators}
\label{subsec:fermionic-be}

Here, we aim to define a family of unitaries ($\{U_{b^\dagger_j}, U_{b_j}\}$) that generate block-encodings of the associated fermionic creation ($b_j^\dagger$) and annihilation ($b_j$) operators.
As these are block-encodings of non-unitary operators, we define the associated unitary operators to be of the form of Eq. \ref{eq:general-block-encoding}:
\begin{equation}
    U_{b^\dagger_j} \ket{\psi} \ket{0}_\text{anc} = b^\dagger_j \ket{\psi}\ket{0}_\text{anc} + \beta_\psi \ket{\perp}
\end{equation}
No rescaling factor is needed for these operators since the fermionic ladder operators have spectral norm of $1$.

The definition of the fermionic creation operator (Eq. \ref{eq:fermionic-creation}) creates two implications.
If the mode is unoccupied, then the mode should become occupied and a sign should be applied based on the occupancy of the preceeding fermionic modes.
If the mode is occupied, then state should be zeroed-out. 
Therefore, the action of our unitary will be dependent on the occupation of the fermionic mode:
\begin{equation}
    U_{b^\dagger_j} \ket{\psi_j} \ket{0}_\text{anc} =
    \begin{cases} 
        \ket{1} \ket{0}_\text{anc} & \text{when $\ket{\psi_j}$ is $\ket{0}$} \\
        \ket{\perp} & \text{when $\ket{\psi_j}$ is $\ket{1}$} \\
    \end{cases}
\end{equation}
where the sign flip caused by the occupation of the preceeding modes is omitted for brevity, but is assumed throughout the remainder of this section.

\begin{figure}[h]
    \mbox{
        \include{figures/qpic-code/fermionic/creation}
        \include{figures/qpic-code/fermionic/annihilation}
    }
    \caption{
        \textbf{Fermionic Ladder Operator Block-Encodings}
        In subfigure a, a block-encoding for the fermionic creation operator acting on the $j^\text{th}$ mode is given.
        In subfigure b, a block-encoding for the fermionic annihilation operator acting on the $j^\text{th}$ mode is given.
        For a creation (annihilation) operator, the branch of the wavefunction will be flipped outside of the encoded subspace if the mode is occupied (unoccupied).
        The state is updated by applying Pauli $Z$ gates to the preceeding fermionic modes to apply the appropriate sign and then applying a Pauli $X$ gate to flip the occupation of the $j^\text{th}$ mode.
    }
    \label{fig:fermionic-be}
\end{figure}


A valid construction for $U_{b^\dagger_j}$ is given in subfigure \ref{fig:fermionic-be}a.
The initial Toffoli gate flips the ancilla qubit to indicate that the state has been zeroed-out when the control qubit is on ($\ket{1}$) and the fermionic mode is occupied ($\ket{1}$).
Regardless of the state of the block-encoding ancilla qubit, the sign of the output state can be applied appropriately using a series of controlled Pauli $Z$ operators applied to each of the fermionic modes with index $i < j$: $\vec{Z}_i$.
The occupation of the fermionic mode on which the ladder operator acts upon is updated using a controlled Pauli $X$ operator: $X_j$.

A block-encoding for the fermionic annihilation operator, $U_{b_j}$, can be constructed similarly to $U_{b^\dagger_j}$ and is shown in subfigue \ref{fig:fermionic-be}b.
The fermionic creation operator only acts nontrivially when the mode is \textit{unoccupied}.
Inversely, the fermionic annihilation operator will only act nontrivially if the mode is \textit{occupied}.
Therefore the block-encoding ancilla is flipped outside of the encoded subspace if the control qubit is on ($\ket{1}$) and the fermionic mode is unoccupied.
These constructions have an optimal rescaling factor ($\lambda = 1$), require one block-encoding ancilla, and use one Toffoli gate.

\subsection{Products of Fermionic Ladder Operators}

As discussed in subsection \ref{subsec:be-products}, a block-encoding for a product of operators can be constructed using a product of the unitaries that block-encode each operator.
In this subsection, we construct block-encodings for a product of fermionic ladder operators that use fewer quantum resources than are required by this naive strategy.

\begin{figure}[h]
    \mbox{
        \include{figures/qpic-code/fermionic/products/number-operator}
        \include{figures/qpic-code/fermionic/products/2-number-ops-together}
    }
    \mbox{
        \include{figures/qpic-code/fermionic/products/2-body}
        \include{figures/qpic-code/fermionic/products/2-body-number-operator}
    }
    \caption{
        \textbf{Block-Encoding Products of Fermionic Ladder Operators}
        In subfigure a, a block-encoding for the fermionic number operator acting on the $j^\text{th}$ mode is given.
        In subfigure b, a block-encoding for the product of two fermionic number operators acting on the $j^\text{th}$ and $l^\text{th}$ modes is given.
        In subfigure c, a block-encoding for the operator $b_j^\dagger b_l$ with $i \neq l$ is given.
        In subfigure d, a block-encoding for the operator $b_j^\dagger b_j b_l$ with $i \neq l$ is given.
    }
    \label{fig:fermionic-products-be}
\end{figure}

As a simple example where we can produce a more efficient construction, consider the fermionic number operator: $b_j^\dagger b_j$.
Note the behavior of the conjoined operator on an arbitrary quantum state:
\begin{equation}
    \begin{split}
        b_j^\dagger b_j \ket{\psi_{b_j}} = \begin{cases} 
            \ket{1} & \text{when $\ket{\psi_{b_j}}$ is $\ket{1}$} \\
            0 & \text{when $\ket{\psi_{b_j}}$ is $\ket{0}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
If the $j^\text{th}$ mode is unoccupied, the state will be zeroed-out.
If the $j^\text{th}$ mode is occupied, then the state is left unchanged.
We can describe this action using the circuit shown in subfigure \ref{fig:fermionic-products-be}a.
The Toffoli gate flips the block-encoding ancilla outside the subspace if the control is on and the $j^\text{th}$ mode is unoccupied.
Otherwise, the state of the system and the block-encoding ancilla are left unchanged.
Block-encoding this operator as the product of the block-encodings for $b_j^\dagger$ and $b_j$ would require $2$ Toffoli gates and $2$ block-encoding ancillae.
The construction given here requires only one Toffoli gate and one block-encoding ancilla.

For a more general product of two fermionic ladder operators, a block-encoding circuit for the operator $b_j^\dagger b_l$ is given in subfigure \ref{fig:fermionic-products-be}c.
For this operator, we can infer that the state will be zeroed-out \textit{unless} both the $j^\text{th}$ mode is unoccupied and the $l^\text{th}$ mode is occupied.
The temporary logical-AND of these two conditions is stored in a clean ancilla.
If the control qubit is on and these two conditions on the system are not true, then the block-encoding ancilla is flipped outside of the encoded subspace.
After the state of the block-encoding ancilla is determined, the system is updated by applying the two operators onto the system in order: $b_l$ then $b_j^\dagger$.
These operators are applied using similar operators of the form $\vec{Z}X$ which applies the appropriate sign flip based on the occupation of the preceeding modes and updates the occupation of the fermionic mode.
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires one block-encoding ancilla, and uses two Toffoli gates.


This construction can be generalized to an arbitrary product of ladder operators.
Let $B$ represent the number of active modes in a term where we define an active mode as a mode that has a ladder operator applied to it.
For example, the term $b_i b_j^\dagger b_k b_l^\dagger b_l$ has $4$ active modes.
Each active mode will contribute a new control on the state of the mode.
For a general product of fermionic ladder operators, a block-encoding circuit of this form will have an optimal rescaling factor ($\lambda = 1$), require only one block-encoding ancilla, and use $B$ Toffoli gates.
The count of $B$ Toffoli gates assumes that each $B$-controlled NOT gate is decomposed into a series of $B-1$ Toffoli gates as described in Appendix \ref{sec:elbows}.

\ws{
A natural question to ask is how do these constructions compare with using an LCU block-encoding after applying the Jordan-Wigner transformation \cite{}?
The Jordan-Wigner transformation maps each fermionic ladder operator (or number operator) to a sum of two Pauli operators.
For an arbitrary product of fermionic ladder operators, expanding these linear combinations results in $2^{B}$ Paulis.
The number of non-Clifford gates for LCU scales linearly with the number of operators and hence would scale exponentially with $B$ under this construction.
Alternatively, one could construct LCU block-encodings for each of the ladder operators in a term by applying the Jordan-Wigner transformation to each ladder operator (or number operator) independently.
The product of these block-encodings would then give a block-encoding of the term.
For each ladder operator (or number operator), an LCU block-encoding would require one Toffoli gate and one ancilla qubit.
A block-encoding of the whole term using this construction would then require $B$ Toffoli gates and $B$ block-encoding ancillae.
}

\subsection{Linear Combinations of Fermionic Ladder Operators}


As discussed in subsection \ref{subsec:be-products}, a block-encoding for a linear combination of operators can be constructed using the LCO framework (Theorem \ref{th:lco}).
In this subsection, we show how to construct block-encodings of linear combinations of products of fermionic ladder operators that use fewer quantum resources than are required by an LCO construction.
In particular, we give a generalizable construction for a product of fermionic ladder operators plus its hermitian conjugate.
However, we note that the strategies we present here are not restricted only to these linear combinations.

\begin{figure}
    \mbox{
        \include{figures/qpic-code/fermionic/combinations/1-body-hc}
        \include{figures/qpic-code/fermionic/combinations/2-body-hc}
    }
    \include{figures/qpic-code/fermionic/combinations/3-body-hc}
    \caption{
        \textbf{Block-Encoding Product of Fermionic Operators Plus Hermitian Conjugate}
        In subfigure a, a block-encoding for the operator $b_j + b_j^\dagger$ is given.
        In subfigure b, a block-encoding for the operator $b_j b_l + b_l^\dagger b_j^\dagger$ is given.
        In subfigure c, a block-encoding for the operator $b_j b_l b_n + b_n^\dagger b_l^\dagger b_j^\dagger$ is given.
        For the 3-body term, the $CZ$ gate is not present since the swapping of the order of the operators results in both terms being positive: $b_j b_l b_n + b_j^\dagger b_l^\dagger b_n^\dagger$.
    }
    \label{fig:fermionic-be-lc-small}
\end{figure}


For a simple example, we begin with a linear combination of an individual fermionic ladder operator with its hermitian conjugate: $b_j^\dagger + b_j$.
Consider the action of the joined operator on the two possible occupation states of the $j^\text{th}$ fermionic mode:
\begin{equation}
    \begin{split}
        (b_j^\dagger + b_j) \ket{\psi_{b_j}} = \begin{cases} 
            \ket{1} & \text{when $\ket{\psi_{b_j}}$ is $\ket{0}$} \\
            \ket{0} & \text{when $\ket{\psi_{b_j}}$ is $\ket{1}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
where the sign flip depending on the parity of the occupation of the preceeding fermionic modes is again omitted in this section for brevity.
From this perspective, it is obvious that a block-encoding for this linear combination of operators can be achieved simply using a Pauli $X$ gate on the $j^\text{th}$ mode and Pauli $Z$ gates on each fermionic mode with index $i < j$.
A circuit diagram for this block-encoding is shown in subfigure \ref{fig:fermionic-be-lc-small}a.
One might notice that this is the same construction one would arrive at using the Jordan-Wigner transformation of the above operators.
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires no ancilla and no non-Clifford gates.
An LCO construction using the block-encodings for these two ladder operators individually would have a rescaling factor of $2$, would require one block-encoding ancillae, and one Toffoli gate to index between the two terms.


For a two-body fermionic operator and its hermitian conjugate ($b_j b_l + b_l^\dagger b_j^\dagger$) we arrive at a construction that differs from the Jordan-Wigner transformation.
We begin by swapping the operators in the second term using the anticommutation relations to ensure that the order is the same: $b_j b_l - b_j^\dagger b_l^\dagger$.
In the circuit, the serial order in which we apply the operators is fixed so it must be consistent for both terms.
The action of the joined operator on the possible occupation states of the $i^\text{th}$ and $j^\text{th}$ fermionic modes is given by:
\begin{equation}
    \begin{split}
        (b_j b_l - b_j^\dagger b_l^\dagger) \ket{\psi_{b_j}, \psi_{b_l}} = \begin{cases} 
            \hspace{1em}\ket{11} & \text{when $\ket{\psi_{b_j}, \psi_{b_l}}$ is $\ket{00}$} \\
            -\ket{00} & \text{when $\ket{\psi_{b_j}, \psi_{b_l}}$ is $\ket{11}$} \\
                                        \end{cases}
    \end{split}
\end{equation}
The sign flip caused by the parity of the preceeding modes will be consistent for both terms since the order at which the operators appear in each term is consistent. 
The desired action of this operator on the state is determined by the parity of the two fermionic modes.
If $\ket{a} = \ket{\psi_{b_j}} \oplus \ket{\psi_{b_l}}$, then the state will be zeroed-out by the operator \textit{unless} $\ket{a} = \ket{0}$.

In subfigure \ref{fig:fermionic-be-lc-small}b, we give a circuit diagram for block-encoding this two-body operator.
The variable $\ket{a}$ can be computed using two CNOT gates targeting a clean ancilla and controlled on the $j^\text{th}$ and $l^\text{th}$ fermionic modes.
If the control qubit is on and $\ket{a}$ is in the $\ket{0}$ state, then the block-encoding ancilla is flipped to push that branch of the wavefunction outside of the encoded subspace.
After this operation, the variable $\ket{a}$ can be uncomputed, returning this ancilla to a clean state.
Next, a $CZ$ gate that is $0$-controlled on the $j^\text{th}$ fermionic mode applies the desired sign flip onto the state corresponding to the term $- b_j^\dagger b_l^\dagger$.
Lastly, a series of $\vec{Z}X$ operators are applied to each active mode in the order at which the operators would be applied onto the quantum state (right to left).

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/2-body-diff-daggers}
    \include{figures/qpic-code/fermionic/combinations/2-body-and-number-op}
    \caption{
        \textbf{Block-Encoding Product of Fermionic Operators Plus Hermitian Conjugate (modifications)}
        In subfigure a, a block-encoding for the operator $b_j b_l^\dagger + b_l b_j^\dagger$ is given.
        In subfigure b, a block-encoding for the operator $b_j b_l^\dagger b_n^\dagger b_n + b_n^\dagger b_n b_l b_j^\dagger$ is given.
    }
    \label{fig:fermionic-be-lc-modifications}
\end{figure}

For an operator with the form $b_i b_j^\dagger + b_j b_i^\dagger$, we can construct a block-encoding using with a slight modification.
In this case, we compute the variable $\ket{a}$ with the CNOT acting on the $j^\text{th}$ mode being $0$-controlled.
The circuit diagram for block-encoding this operator is given in subfigure \ref{fig:fermionic-be-lc-modifications}a.
Likewise, if a number operator is included in a term, then this can be accounted for by including a $1$-control on that mode when determining if the block-encoding ancilla should be flipped.
An example circuit diagram for an operator including a number operator is given in subfigure \ref{fig:fermionic-be-lc-modifications}b.

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/generalized}
    \caption{
        \textbf{Generalized Block-Encoding for Product of Fermionic Operators Plus Hermitian Conjugate}
        A block-encoding for the operator $b_i b_j ... b_m + b_m^\dagger ... b_j^\dagger b_i^\dagger$ is given.
        The $CZ$ gate highlighted in orange is present if $C \text{ choose } 2$ is odd where $C$ is the number of active modes excluding modes with number operators acting on them.
        Block-encodings for similar operators such as those that include number operators or different arrangements of the creation and annihilation operators can be accounted for using the modifications shown in Figure \ref{fig:fermionic-be-lc-modifications}.
    }
    \label{fig:fermionic-be-lc}
\end{figure}

The construction of these block-encoding circuits can be generalized to any operator that is a product of fermionic operators plus its hermitian conjugate.
An example circuit diagram for this generalized construction is shown in Figure \ref{fig:fermionic-be-lc}.
The $CZ$ gate that applies the sign flip on the second term that can occur when the order of the fermionic operators is swapped is only present if the number of swaps is odd.
If $C$ represents the number of active modes excluding modes where a number operator is acting on the mode, then the number of required swaps is $C \text{ choose } 2$.
In general, these block-encoding circuits will all have optimal rescaling factors ($\lambda=1$), require one block-encoding ancilla, and use $B-1$ Toffoli gates where $B$ is the number of active modes in the operator.

\begin{figure}
    \include{figures/qpic-code/fermionic/combinations/non-conjugate}
    \caption{
        \textbf{Block-Encoding for Linear Combination of Non-Conjugate Fermionic Operators}
        A block-encoding for the operator $b_i b_j b_k^\dagger + b_j^\dagger b_i^\dagger b_k^\dagger$ is given.
    }
    \label{fig:fermionic-be-lc-not-conjugate}
\end{figure}


As mentioned, the strategy employed here to construct block-encodings of a linear combination of operators is not restricted to a linear combination of hermitian conjugates.
Consider the action of the operator $b_i b_j b_k^\dagger + b_j^\dagger b_i^\dagger b_k^\dagger$ on the occupation states of the fermionic modes.
Note that the second term is not the Hermitian conjugate since the ladder operator acting on the $k^\text{th}$ mode is a creation operator in both terms.
If $\ket{a} = \ket{\psi_{b_i}} \oplus \ket{\psi_{b_j}}$, then this operator will zero-out the state \textit{unless} both $\ket{a}$ and $\ket{\psi_{b_k}}$ are $\ket{0}$.
The implementation of the block-encoding for this operator is given in Figure \ref{fig:fermionic-be-lc-not-conjugate}.
This block-encoding circuit has an optimal rescaling factor ($\lambda = 1$), requires one block-encoding ancilla, and uses two Toffoli gates.

\subsection{Bosonic Ladder Operators}

Here, we aim to define a family of unitaries ($\{U_{a^\dagger_i}, U_{a_i}\}$) that generate block-encodings of the associated bosonic creation ($a_i^\dagger$) and annihilation ($a_i$) operators.
Recall the definition of the bosonic creation operator given in Equation \ref{eq:bosonic-creation}.
From this definition, it is clear that if we rescale the operator by a factor of $\lambda = \sqrt{\Omega}$, then we can define a block-encoding unitary of the form of Eq. \ref{eq:general-block-encoding}: 
\begin{equation}
    \label{eq:be-bos-creation}
    U_{a^\dagger_i} \ket{\omega_i} \ket{0}_\text{anc} = 
    \begin{cases}
        \sqrt{\frac{\omega_i + 1}{\Omega}} \ket{\omega_i + 1} \ket{0}_\text{anc} + \beta_\psi \ket{\perp} & \text{when } \omega_i < \Omega \\
        \ket{\perp} & \text{when } \omega_i = \Omega \\
    
    \end{cases}
\end{equation}
where $\omega_i$ is the occupation number of the $i^\text{th}$ bosonic mode.

\begin{figure}
    \mbox{
        \include{figures/qpic-code/bosonic/creation}
        \include{figures/qpic-code/bosonic/annihilation}
    }
    \caption{
        \textbf{Bosonic Ladder Operator Block-Encoding}
        In subfigure a, a block-encoding for the bosonic creation operator, $a_i^\dagger$, is given.
        In subfigure b, a block-encoding for the bosonic annihilation operator, $a_i$, is given.
    }
    \label{fig:bosonic-ladder-op-be}
\end{figure}

The desired action of the block-encoding circuit for the bosonic creation operator is to increase the occupation of the bosonic mode by $1$ and rotate the block-encoding ancilla such that it has a coefficient of $\sqrt{\frac{\omega_i + 1}{\Omega}}$ in the $\ket{0}$ state when the occupation of the $i^\text{th}$ bosonic mode is $w_i$ prior to the operation.
This can be achieved by applying an incrementer circuit to the register encoding the occupation of the bosonic mode which increases the occupation by $1 \mod \Omega$ in each branch of the wavefunction.
The corresponding coefficients can be attained using a series of $R_y$ gates with different angles, controlled on the corresponding occupation state of the bosonic mode, and applied to the block-encoding ancilla.
An example circuit diagram for this circuit is given in subfigure \ref{fig:bosonic-ladder-op-be}a.
The angle of the $R_y$ gate can be classically determined by the following function:
\begin{equation}
    \label{eq:single-op-angles}
    \theta(\omega_i) = 
    \begin{cases} 
        2\sin^{-1}\Big(\sqrt{\frac{\omega_i}{\Omega}}\Big) & \text{when } \omega_i < \Omega\\
        0 & \text{when } \omega_i = \Omega
    \end{cases}
\end{equation}
where the choice of $\omega_i$ here in comparison with $\omega_i + 1$ in Eq. \ref{eq:be-bos-creation} is due to the occupation of the state being updated prior to these rotations.

A block-encoding circuit for the bosonic annihilation operator can be constructed similarly.
The only necessary modification is that the multiplexed rotations are applied prior to the incrementer circuit.
An example circuit diagram is given in subfigure \ref{fig:bosonic-ladder-op-be}b.

An implementation of a controlled incrementer circuit is given in \cite{Gidney_2015} which requires $\lceil \log_2\Omega \rceil$ Toffoli gates.
The series of controlled rotation gates can be implemented using a set of multiplexed rotations which can be decomposed via the protocol given in Möttönen et. al \cite{mottonen2004transformation}.
A discussion of different schemes to construct a \textit{controlled} set of multiplexed rotations is given in Appendix \ref{sec:multiplexed-rotations} and we opt for the decomposition that requires $\Omega$ uncontrolled rotations and $1$ controlled rotation.
A controlled rotation can be decomposed into $2$ uncontrolled rotations as shown in Figure \ref{fig:controlled-rotation}.
As a result, this block-encoding has a rescaling factor of $\sqrt{\Omega}$, requires one block-encoding ancilla, and uses $\lceil \log_2\Omega \rceil$ Toffoli gates and $\Omega + 2$ arbitrary rotations.


\subsection{Products of Bosonic Ladder Operators}

In this subsection, we discuss constructing block-encodings for a product of bosonic ladder operators acting on the same mode.

Unlike fermions, multiple bosons can occupy the same bosonic mode.
Therefore a bosonic ladder operator that is raised to an integer power can be applied to the state without necessarily zeroing-out the state.
Consider the desired action of a block-encoding for series of $R$ bosonic creation operators acting on the $i^\text{th}$ bosonic mode:
\begin{equation}
    \label{eq:be-S-creation-ops}
    U_{(a^\dagger_i)^R} \ket{\omega_i} \ket{0}_\text{anc} = 
    \begin{cases}
        \prod_{r=1}^{R} \sqrt{\frac{\omega_i + r}{\Omega}} \ket{\omega_i + R} \ket{0}_\text{anc} + \beta_\psi \ket{\perp} & \text{when } \omega_i \leq \Omega - R \\
        \ket{\perp} & \text{when } \omega_i > \Omega - R \\
    
    \end{cases}
\end{equation}

\begin{figure}
    \mbox{
        \include{figures/qpic-code/bosonic/products/R-creation}
        \include{figures/qpic-code/bosonic/products/S-annihilation}
    }
    \include{figures/qpic-code/bosonic/products/R-creation-S-annihilation}
    \caption{
        \textbf{Block-Encoding Product of Bosonic Ladder Operators}
        In subfigure a, a block-encoding for the operator $(a_i^\dagger)^R$ is given.
        In subfigure b, a block-encoding for the operator $(a_i)^S$ is given.
        In subfigure c, a block-encoding for the operator $(a_i^\dagger)^R (a_i)^S$ is given.
    }
    \label{fig:products-bosonic-operators}
\end{figure}

A block-encoding of this form could be achieved by simply repeating the construction for the individual bosonic creation operator (subfigure \ref{fig:bosonic-ladder-op-be}a) $R$ times.
However, a more efficient compilation can be achieved by updating the occupation of the bosonic mode by $+R$ and then performing a single series of controlled multiplexed rotations.
An example circuit diagram for this block-encoding is shown in subfigure \ref{fig:products-bosonic-operators}a.
The angles of the multiplexed rotations can be determined classically using the following function:
\begin{equation}
    \theta(\omega_i, R) = 
    \begin{cases} 
        2\sin^{-1}\Big(\prod_{r=0}^{R-1}\sqrt{\frac{\omega_i - r}{\Omega}}\Big) & \text{when } \omega_i \leq \Omega - R \\
        0 & \text{when } \omega_i > \Omega - R
    \end{cases}
\end{equation}
where the choice of $\omega_i - r$ here in comparison with $\omega_i + r$ in Eq. \ref{eq:be-S-creation-ops} is due to the occupation of the state being updated prior to these rotations.

A block-encoding for a bosonic annihilation operator being applied $S$ times can be achieved using a similar construction shown in subfigue \ref{fig:products-bosonic-operators}b.
The occupation of the mode is first decreased by $S$ and then the controlled multiplexed rotations are applied to pick up the corresponding coefficient on the block-encoding ancilla.
The function to determine the rotation angles is given by:
\begin{equation}
    \theta(\omega_i, S) = 
    \begin{cases} 
        2\sin^{-1}\Big(\prod_{s=1}^{S}\sqrt{\frac{\omega_i + s}{\Omega}}\Big) & \text{when } \omega_i \geq S \\
        0 & \text{when } \omega_i < S
    \end{cases}
\end{equation}

Likewise, we can construct a block-encoding for an operator of the form $(a_i^\dagger)^R (a_i)^S$ using a similar construction shown in subfigue \ref{fig:products-bosonic-operators}c.
The occupation of the mode is updated by a value of $+ R - S$ and then the controlled multiplexed rotations are applied to pick up the corresponding coefficient on the block-encoding ancilla.
The function to determine the rotation angles is given by:
\begin{equation}
    \theta(\omega_i, R, S) = 
    \begin{cases} 
        2\sin^{-1}\Big(\prod_{r=0}^{R-1}\sqrt{\frac{\omega_i - r}{\Omega}} \prod_{s=1}^{S}\sqrt{\frac{\omega_i - R + s}{\Omega}}\Big) & \text{when } S \leq \omega_i \leq \Omega - R \\
        0 & \text{Otherwise} 
    \end{cases}
\end{equation}

Incrementing a quantum register by a classical value can be implemented in multiple ways with different compilations having different space-time tradeoffs.
In this work, we often choose decompositions that reduce the number of non-Clifford operations at the expense or requiring more temporary ancillae, therefore we opt for the compilation given in Figure \ref{fig:addition-gate-efficient}.
This circuit requires, at most, $\lceil \log_2 \Omega \rceil - 1$ pairs of left and right elbows.
These block-encoding circuits have a rescaling factor of $\lambda = \Omega^{R+S/2}$, require one block-encoding ancilla, and use \textit{at most} $\Omega + \lceil \log_2 \Omega \rceil$ pairs of elbows and $\Omega + 2$ arbitrary rotations.


\subsection{Linear Combinations of Bosonic Ladder Operators}

In this subsection, we discuss constructing block-encodings for a linear combination of a product of bosonic ladder operators acting on the same mode plus its hermitian conjugate.

For a simple example, consider the operator $a_i^\dagger + a_i$.
Trivially, one could construct an LCO block-encoding by performing a linear combination of the block-encodings of the creation and annihilation operators respectively.
This block-encoding would have a rescaling factor of $\lambda = 2\sqrt{\Omega}$, use two block-encoding ancilla, and require $2\big(\lceil \log_2 \Omega \rceil - 1\big)$ pairs of elbows and $2 \big(\Omega + 2\big)$ arbitrary rotations.


\begin{figure}
    \include{figures/qpic-code/bosonic/combinations/1-op}
    \include{figures/qpic-code/bosonic/combinations/multi-ops}
    \caption{
        \textbf{Block-Encoding Product of Bosonic Ladder Operators Plus Hermitian Conjugate}
        In subfigure a, a block-encoding for the operator $(a_i^\dagger + a_i)$ is given.
        In subfigure b, a block-encoding for the operator $\big((a_i^\dagger)^R (a_i)^S + (a_i^\dagger)^S (a_i)^R\big)$ is given.
    }
    \label{fig:lc-bosonic}
\end{figure}


Due to the symmetry of the block-encodings for the individual operators, we can produce a more gate-efficient compilation.
For the annihilation operator, we wish to decrease the occupancy by $1$ and then apply the rotations.
Whereas for the creation operator, we wish in apply the rotations and then increase the occupancy by $1$.
Since the desired rotation angles are independent of which operator is being applied (Eq. \ref{eq:single-op-angles}), we can reuse the multiplexed rotations to apply the appropriate angles for both terms.
An example circuit diagram for this block-encoding is shown in subfigue \ref{fig:lc-bosonic}a.
Similarly, a block-encoding for the generalized operator $\big((a_i^\dagger)^R (a_i)^S + (a_i^\dagger)^S (a_i)^R\big)$ can be constructed and is shown in subfigure \ref{fig:lc-bosonic}b.

This compilation strategy is chosen under the assumption that the cost of implementing the multiplexed rotations exceeds the cost of the incrementer circuit.
If the inverse were true, a compilation could be constructed where the incrementer circuit is reused for both terms and the multiplexed rotations would be applied twice.  

For these block-encoding circuits, one additional pair of elbows is required to index between the two controlled incrementer circuits in Figure \ref{fig:lc-bosonic}.
Therefore, these block-encodings have a rescaling factor of $\lambda = 2 \Omega^{R+S/2}$, use two block-encoding ancilla, and require $\Omega + 2\big(\lceil \log_2 \Omega \rceil\big)$ pairs of elbows and $\Omega + 2$ arbitrary rotations.

\subsection{Terms with Fermionic and Bosonic Ladder Operators}

In the previous subsections, we discussed strategies for compiling block-encodings of different products and linear combinations of ladder operators acting on either fermionic or bosonic modes.
In this subsection, we discuss how to generate block-encodings for operators that contain both fermionic and bosonic operators.

\begin{figure}
    \include{figures/qpic-code/terms/naive-construction}
    \include{figures/qpic-code/terms/non-naive-construction}
    \include{figures/qpic-code/terms/non-naive-yukawa}
    \caption{
        \textbf{Block-Encoding Terms}
        In subfigure a, a naive block-encoding for the operator $b_i a_j + a_j^\dagger b_i^\dagger$ is given.
        In subfigure b, a block-encoding for the operator $\big((a_i^\dagger)^R (a_i)^S + (a_i^\dagger)^S (a_i)^R\big)$ is given.
    }
    \label{fig:be-term-example}
\end{figure}


As an example, consider the operator: $b_i a_j + a_j^\dagger b_i^\dagger$.
Using Theorems \ref{th:product} and \ref{th:lco} to construct block-encodings of the individual terms and then combining them together would have a rescaling factor of $\lambda = 2*\sqrt{\Omega}$ and use $3$ block-encoding ancillae.
Additionally, the non-Clifford gate-cost would be $3$ Toffoli gates, 2 controlled incrementers, and $2*\Omega$ arbitrary rotations.
A circuit diagram for this construction is given in subfigure \ref{fig:be-term-example}a.

However, we can instead block-encode the entire operator at once by noting the action of the conjoined operator on the different occupation states of the fermionic mode.
Using the circuit shown in subfigure \ref{fig:be-term-example}b, the occupation of the fermionic mode is used to determine which bosonic operator is applied to the bosonic mode.
If the fermionic mode is occupied, then the bosonic annihilation operator is applied to apply the term $b_i a_j$.
If the fermionic mode is unoccupied, then the bosonic creation operator is applied to apply the term $b_i^\dagger a_j^\dagger$.
This block-encoding will have a rescaling factor of $\lambda = \sqrt{\Omega}$, use $1$ block-encoding ancillae, and require $1$ Toffoli gate, $2$ controlled incrementers, and $\Omega$ arbitrary rotations.

This strategy can be employed for other combinations of bosonic and fermionic ladder operators.
In the full Yukawa model, the operator $b_i b_j a_k^\dagger + b_j^\dagger b_i^\dagger a_k$ is used to describe the process of a fermion and antifermion being annihilated to form a boson as well as a boson being annihilated to form a fermion and antifermion.
For this operator, the occupation of either mode can be used to dictate which bosonic operator is applied to the system.
If both modes are occupied, then the bosonic creation operator should be applied.
If both modes are unoccupied, then the bosonic annihilation operator should be applied.
If the occupation of the two modes are not the same, then the state will be zeroed-out and the block-encoding ancilla for the fermionic modes will be flipped outside of the encoded subspace, therefore the action performed on the bosonic state will not matter.
A circuit diagram for this block-encoding is shown in subfigure \ref{fig:be-term-example}c.
This block-encoding has a rescaling factor of $\lambda = \sqrt{\Omega}$, uses $2$ block-encoding ancillae, and requires $2$ Toffolis, $2$ controlled incrementers, and $\Omega$ arbitrary rotations.


